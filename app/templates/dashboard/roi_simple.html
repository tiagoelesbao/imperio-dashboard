{% extends "base_simple.html" %}

{% block title %}Dashboard ROI - ROI Detalhado{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h2 mb-3">ROI Detalhado</h1>
            <p class="text-muted">Análise completa do retorno sobre investimento por canal.</p>
        </div>
    </div>

    <!-- Campaign Info -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-primary" role="alert">
                <i class="fas fa-bullhorn me-2"></i>
                <strong>Sorteio 200mil - Ação Atual</strong> | Meta ROI: 2.0x | Orçamento: R$ 10.000/dia
            </div>
        </div>
    </div>

    <!-- ROI Cards -->
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Canal Geral</h5>
                </div>
                <div class="card-body text-center">
                    <div class="metric-value text-primary" id="roi-geral">0.00</div>
                    <small class="text-muted">ROI Atual</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Instagram</h5>
                </div>
                <div class="card-body text-center">
                    <div class="metric-value text-success" id="roi-instagram">0.00</div>
                    <small class="text-muted">ROI Atual</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">Grupos WhatsApp</h5>
                </div>
                <div class="card-body text-center">
                    <div class="metric-value text-warning" id="roi-grupo">0.00</div>
                    <small class="text-muted">ROI Atual</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-3x text-info mb-3"></i>
                    <h4>ROI Detalhado</h4>
                    <p class="text-muted" id="status-message">Sistema iniciado com dados limpos. Aguardando coleta de dados.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function loadROIData() {
    try {
        const response = await fetch('/api/dashboard/summary');
        if (!response.ok) {
            return;
        }
        
        const data = await response.json();
        
        // Atualizar ROI por canal
        const roiGeral = document.getElementById('roi-geral');
        if (roiGeral && data.channels && data.channels.geral) {
            roiGeral.textContent = data.channels.geral.roi.toFixed(2);
        }
        
        const roiInstagram = document.getElementById('roi-instagram');
        if (roiInstagram && data.channels && data.channels.instagram) {
            roiInstagram.textContent = data.channels.instagram.roi.toFixed(2);
        }
        
        const roiGrupo = document.getElementById('roi-grupo');
        if (roiGrupo && data.channels && data.channels.grupo) {
            roiGrupo.textContent = data.channels.grupo.roi.toFixed(2);
        }
        
        // Atualizar status
        const statusMessage = document.getElementById('status-message');
        if (statusMessage && data.current_roi > 0) {
            statusMessage.innerHTML = '<i class="fas fa-check-circle me-2"></i>Dados atualizados! ROI geral: ' + data.current_roi.toFixed(2) + 'x';
        }
        
    } catch (error) {
        console.log('Erro ao carregar dados ROI:', error);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    setTimeout(loadROIData, 2000);
    setInterval(loadROIData, 30000);
});
</script>
{% endblock %}